(function ($) {

	window.myprompt = myprompt;
	window.mykill = mykill;
	window.mywait = mywait;
	window.myappend = myappend;
	window.myinfo = myinfo;

	function myprompt(string, args, callbacktrue, callbackfalse) {
		apprise(string, args, function (r) {
			if (r) {
				callbacktrue();
			}
			else {
				callbackfalse();
			}
		});
	}

	function mywait(string, args, callback) {
		apprise('<img src="images/ajax-loader2.gif" align=\'absmiddle\' />' + '<br><br>' + string, args, callback);
	}

	function myappend(string) {
		$('.appriseInner').append(string);
	}

	function mykill() {
		$('.appriseOverlay').remove();
		$('.appriseOuter').remove();
	}

	function myinfo(string, args, callback) {
		if (args)
			args['ok'] = true; else
			var args = {'ok': true};
		apprise(string, args, callback);
	};
	function apprise(string, args, callback) {
		var default_args = {'confirm': false, 'verify': false, 'ok': false, 'input': false, 'animate': false, 'check': false, 'textOk': 'Ok', 'textCancel': 'Cancel', 'textYes': 'Yes', 'textNo': 'No', 'js': ''}
		if ($(".appriseOuter").length)
			$(".appriseOuter").remove();
		if (args) {
			for (var index in default_args) {
				if (typeof args[index] == "undefined")args[index] = default_args[index];
			}
		}
		$('body').append('<div class="appriseOverlay" id="aOverlay"></div>');
		$('.appriseOverlay').fadeIn(100);
		$('body').append('<div class="appriseOuter"></div>');
		$('.appriseOuter').append('<div class="appriseInner"></div>');
		$('.appriseInner').append(string + '<br />');
		if (args) {
			if (args['animate']) {
				var aniSpeed = args['animate'];
				if (isNaN(aniSpeed)) {
					aniSpeed = 400;
				}
				$('.appriseOuter').css('top', '-200px').show().animate({top: "40%"}, aniSpeed);
			}
			else {
				$('.appriseOuter').css('top', '40%').fadeIn(200, function () {
					$('.appriseInner').find("input").eq(0).focus();
				});
			}
		}
		else {
			$('.appriseOuter').css('top', '40%').fadeIn(200, function () {
				$('.appriseInner').find("input").eq(0).focus();
			});
		}
		if (args) {
			if (args['input']) {
				if (typeof(args['input']) == 'string') {
					$('.appriseInner').append('<div class="aInput"><input type="text" class="aTextbox" t="aTextbox" value="' + args['input'] + '" /></div>');
				}
				else {
					$('.appriseInner').append('<div class="aInput"><input type="text" class="aTextbox" t="aTextbox" /></div>');
				}
				$('.aTextbox').focus();
			}
		}
		$('.appriseInner').append('<div class="aButtons"></div>');
		if (args) {
			if (args['confirm'] || args['input']) {
				$('.aButtons').append('<button value="cancel" class="btn btn-large acancel hormargin"><i class="icon-remove"></i> ' + args['textCancel'] + '</button>');
				$('.aButtons').append('<button class="btn btn-large btn-highlight hormargin" value="ok"><i class="icon-ok"></i> ' + args['textOk'] + '</button>');
			}
			else if (args['verify']) {
				$('.aButtons').append('<button value="cancel" class="btn btn-large acancel hormargin"><i class="icon-remove"></i> ' + args['textNo'] + '</button>');
				$('.aButtons').append('<button class="btn btn-large btn-highlight hormargin" value="ok"><i class="icon-ok"></i> ' + args['textYes'] + '</button>');
			}
			else if (args['ok']) {
				$('.aButtons').append('<button class="btn btn-large btn-highlight hormargin" value="ok"><i class="icon-ok"></i> ' + args['textOk'] + '</button>');
			}
		}
		if (args) {
			if (args['js'].length > 0) {
				eval(args['js']);
			}
		}
		$(document).keydown(function (e) {
			if ($('.appriseOverlay').is(':visible')) {
				if (e.keyCode == 13) {
					$('.aButtons > button[value="ok"]').click();
				}
				if (e.keyCode == 27) {
					$('.aButtons > button[value="cancel"]').click();
				}
			}
		});
		var aText = $('.aTextbox').val();
		if (!aText) {
			aText = false;
		}
		$('.aTextbox').keyup(function () {
			aText = $(this).val();
		});
		$('.aButtons > button').click(function () {
			if (!args['check'] || $(this).attr("value") != 'ok') {
				$('.appriseOverlay').remove();
				$('.appriseOuter').remove();
			}
			if (callback) {
				var wButton = $(this).attr("value");
				if (wButton == 'ok') {
					if (args) {
						if (args['input']) {
							callback(aText);
						}
						else {
							callback(true);
						}
					}
					else {
						callback(true);
					}
				}
				else if (wButton == 'cancel') {
					callback(false);
				}
			}
		});
	}
})(jQuery);